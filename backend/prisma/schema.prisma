generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
  schemas   = ["auth", "public"]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model attachments {
  id           BigInt    @id @default(autoincrement())
  project_id   BigInt?
  filename     String    @db.VarChar
  storage_path String    @db.VarChar
  description  String?   @db.VarChar
  uploaded_at  DateTime  @default(now()) @db.Timestamptz(6)
  updated_at   DateTime  @db.Timestamptz(6)
  projects     projects? @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([project_id])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model external_links {
  id          BigInt    @id @default(autoincrement())
  project_id  BigInt?
  url         String?   @db.VarChar
  title       String?   @db.VarChar
  description String?   @db.VarChar
  added_at    DateTime  @default(now()) @db.Timestamptz(6)
  updated_at  DateTime  @db.Timestamptz(6)
  projects    projects? @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([project_id])
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model grades {
  id          BigInt       @id(map: "grade_pkey") @default(autoincrement())
  value       BigInt
  year_id     BigInt
  project_id  BigInt
  reviewer_id String       @db.Uuid
  created_at  DateTime     @default(now()) @db.Timestamptz(6)
  scale_id    BigInt?
  users       public_users @relation(fields: [reviewer_id], references: [id], onUpdate: NoAction, map: "fk_grades_reviewer")
  projects    projects     @relation(fields: [project_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "grade_project_id_fkey")
  years       years        @relation(fields: [year_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "grade_year_id_fkey")
  scales      scales?      @relation(fields: [scale_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([scale_id])
  @@index([reviewer_id], map: "idx_grades_reviewer")
  @@schema("public")
}


/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model projects {
  id                                  BigInt             @id @default(autoincrement())
  title                               String             @db.VarChar
  supervisor_id                       String             @db.Uuid
  opponent_id                         String             @db.Uuid
  student_id                          String?            @db.Uuid
  subject                             String             @db.VarChar
  description                         String?            @db.VarChar
  main_documentation                  String?            @db.VarChar
  status                              status?            @default(draft)
  updated_at                          DateTime           @default(now()) @db.Timestamptz(6)
  attachments                         attachments[]
  external_links                      external_links[]
  grades                              grades[]
  users_projects_opponent_idTousers   public_users       @relation("projects_opponent_idTousers", fields: [opponent_id], references: [id], onUpdate: NoAction, map: "fk_projects_opponent")
  users_projects_supervisor_idTousers public_users       @relation("projects_supervisor_idTousers", fields: [supervisor_id], references: [id], onUpdate: NoAction, map: "fk_projects_supervisor")
  users_projects_student_idTousers    public_users?      @relation("projects_student_idTousers", fields: [student_id], references: [id], onUpdate: NoAction, onDelete: SetNull, map: "fk_projects_student")
  reviews                             reviews[]

  @@index([opponent_id], map: "idx_projects_opponent")
  @@index([supervisor_id], map: "idx_projects_supervisor")
  @@index([student_id], map: "idx_projects_student")
  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model reviews {
  id           BigInt       @id @default(autoincrement())
  project_id   BigInt
  reviewer_id  String       @db.Uuid
  comments     String       @db.VarChar
  submitted_at DateTime     @default(now()) @db.Timestamptz(6)
  updated_at   DateTime     @db.Timestamptz(6)
  users        public_users @relation(fields: [reviewer_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reviews_reviewer")
  projects     projects     @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([reviewer_id], map: "idx_reviews_reviewer")
  @@index([project_id])
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model scale_set_scales {
  id            BigInt     @id @default(autoincrement())
  scale_set_id  BigInt
  scale_id      BigInt
  weight        Int        @db.SmallInt
  display_order Int?       @db.SmallInt
  created_at    DateTime   @default(now()) @db.Timestamptz(6)
  scales        scales     @relation(fields: [scale_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  scale_sets    scale_sets @relation(fields: [scale_set_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("public")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model scale_sets {
  id               BigInt             @id(map: "scale_set_pkey") @default(autoincrement())
  name             String?            @db.VarChar
  year_id          BigInt?
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  project_role     project_role?
  scale_set_scales scale_set_scales[]
  years            years?             @relation(fields: [year_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "scale_set_year_id_fkey")

  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model scales {
  id               BigInt             @id(map: "scale_pkey") @default(autoincrement())
  maxVal           BigInt
  name             String
  desc             String?
  created_at       DateTime           @default(now()) @db.Timestamptz(6)
  grades           grades[]
  scale_set_scales scale_set_scales[]

  @@schema("public")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model public_users {
  id                                     String             @id @db.Uuid
  role                                   user_roles
  full_name                              String?            @db.VarChar
  avatar_url                             String?            @db.VarChar
  created_at                             DateTime           @default(now()) @db.Timestamptz(6)
  updated_at                             DateTime           @default(now()) @db.Timestamptz(6)
  email                                  String             @unique(map: "users_email_unique") @db.VarChar
  year_id                                BigInt?
  grades                                 grades[]
  projects_projects_opponent_idTousers   projects[]         @relation("projects_opponent_idTousers")
  projects_projects_supervisor_idTousers projects[]         @relation("projects_supervisor_idTousers")
  projects_projects_student_idTousers    projects[]         @relation("projects_student_idTousers")
  reviews                                reviews[]
  years                                  years?             @relation(fields: [year_id], references: [id], onUpdate: NoAction, map: "fk_users_year")

  @@index([email], map: "idx_users_email")
  @@index([role], map: "idx_users_role")
  @@index([year_id], map: "idx_users_year_id")
  @@map("users")
  @@schema("public")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model years {
  id              BigInt         @id(map: "year_pkey") @default(autoincrement())
  school_id       BigInt?
  assignment_date DateTime?      @db.Timestamptz(6)
  submission_date DateTime?      @db.Timestamptz(6)
  feedback_date   DateTime?      @db.Timestamptz(6)
  created_at      DateTime       @default(now()) @db.Timestamptz(6)
  grades          grades[]
  scale_sets      scale_sets[]
  users           public_users[]

  @@schema("public")
}

/// This enum is commented in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
enum project_role {
  supervisor
  opponent

  @@schema("public")
}

enum status {
  draft
  submitted
  locked
  public

  @@schema("public")
}

/// This enum is commented in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
enum user_roles {
  admin
  teacher
  student

  @@schema("public")
}
